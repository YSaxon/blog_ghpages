<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="generator" content="Pelican" />
        <title>Yaakov Saxon's Security Blog - Hacking</title>
        <link rel="stylesheet" href="https://blog.stepaheadcyber.com/theme/css/main.css" />
        <link href="https://blog.stepaheadcyber.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Yaakov Saxon's Security Blog Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="https://blog.stepaheadcyber.com/">Yaakov Saxon's Security Blog</a></h1>
                <nav><ul>
                    <li><a href="https://blog.stepaheadcyber.com/category/curiousities.html">Curiousities</a></li>
                    <li class="active"><a href="https://blog.stepaheadcyber.com/category/hacking.html">Hacking</a></li>
                    <li><a href="https://blog.stepaheadcyber.com/category/misc.html">Misc</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://blog.stepaheadcyber.com/reverse-engineering-legu-encryption.html">Reverse Engineering Legu Encryption</a></h1>
<footer class="post-info">
        <abbr class="published" title="2023-07-05T00:00:00-04:00">
                Published: Wed 05 July 2023
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://blog.stepaheadcyber.com/author/yaakov-saxon.html">Yaakov Saxon</a>
        </address>
<p>In <a href="https://blog.stepaheadcyber.com/category/hacking.html">Hacking</a>.</p>

</footer><!-- /.post-info --><p>I recently came across an Android APK that was protected by an obfuscator made by the Chinese tech company Tencent, called Legu. Thankfully, there was a repo available to reverse the obfuscation, but it was out-of-date with respect to the encryption. Specifically, the repo said it supported up to 4.0.1.18, and the version I was seeing was 4.0.1.31. Also, the dependencies were pretty difficult to use.</p>
<p>The TLDR is that I reverse engineered the new encryption scheme (it's now using ChaCha20) and the new key derivation scheme (a multi step process involving two hardcoded keys being altered in subtle ways, and one decoy key not used at all), and updated and published a fork at [https://github.com/YSaxon/legu_unpacker_2023].</p>
<p>But you won't always find the version you need there, if only because Tencent is likely to continue to update the keys. So I wrote up the <em>process</em> of reverse engineering the encryption, so that it can always be updated in the future.</p>
<p>You can find that writeup <a href="https://github.com/YSaxon/legu_unpacker_2023/blob/master/reverse_engineering_tips/reverse_engineering_tips.md">here</a></p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="https://blog.stepaheadcyber.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="https://www.linkedin.com/in/ysaxon/"></a></li>
                            <li><a href="https://github.com/YSaxon"></a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a href="https://www.python.org/">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>